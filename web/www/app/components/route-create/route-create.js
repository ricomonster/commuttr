!function(){"use strict";function e(e,o,t,r){var i=this;i.vehicleLists=[],i.route=[],i.route.coordinates=[],i.route.vehicles=[],i.route.via_route=[{location:""}],i.formErrors=[],i.directionsService="",i.directionsRenderer="",i.map="",i.markers=[],i.polylines=[],i.isFirst=!0,i.initialize=function(){i.user=e.user(),r.transportation().success(function(e){e.vehicles&&(i.vehicleLists=e.vehicles)}),i.initializeGoogleMaps()},i.addViaRoute=function(e){e.preventDefault(),i.route.via_route.push({location:""})},i.select=function(e,o){var t=o.indexOf(e);t>-1?o.splice(t,1):o.push(e)},i.exists=function(e,o){return o.indexOf(e)>-1},i.submitRoute=function(){i.fetchCoordinates(),i.formErrors=[];var e=i.route;r.create(e.route_name,e.destination,e.origin,e.vice_versa,e.via_route,e.vehicles,e.coordinates).success(function(e){e.route&&(i.clearForm(),o.show("You have successfully created the route.",5e3))}).error(function(e){o.show("There are errors encountered.",5e3),i.formErrors=e.errors})},i.clearForm=function(){i.route=[],i.route.coordinates=[],i.route.vehicles=[],i.route.via_route=[{location:""}],i.initializeGoogleMaps()},i.initializeGoogleMaps=function(){var e=t.get("coordinates"),o=new google.maps.LatLng(e.latitude,e.longitude);i.directionsService=new google.maps.DirectionsService,i.directionsRenderer=new google.maps.DirectionsRenderer,i.map=new google.maps.Map(document.getElementById("map_canvas"),{zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,center:o,mapTypeControl:!1,streetViewControl:!1}),i.directionsRenderer.setMap(i.map),google.maps.event.addListener(i.map,"click",function(e){i.addWayPointToRoute(e.latLng)})},i.addWayPointToRoute=function(e){i.isFirst?(i.addFirstWayPoint(e),i.isFirst=!1):i.appendWayPoint(e)},i.addFirstWayPoint=function(e){var o={origin:e,destination:e,travelMode:google.maps.DirectionsTravelMode.DRIVING};i.directionsService.route(o,function(e,o){if(o==google.maps.DirectionsStatus.OK){var t=new google.maps.Marker({position:e.routes[0].legs[0].start_location,map:i.map,draggable:!0});t.arrayIndex=0,i.markers.push(t),google.maps.event.addListener(t,"dragend",function(){i.recalculateRoute(t)})}})},i.appendWayPoint=function(e){var o={origin:i.markers[i.markers.length-1].position,destination:e,travelMode:google.maps.DirectionsTravelMode.DRIVING};i.directionsService.route(o,function(e,o){if(o==google.maps.DirectionsStatus.OK){var t=new google.maps.Marker({position:e.routes[0].legs[0].end_location,map:i.map,draggable:!0});i.markers.push(t),t.arrayIndex=i.markers.length-1,google.maps.event.addListener(t,"dragend",function(){i.recalculateRoute(t)});var r=new google.maps.Polyline({map:i.map,strokeColor:"#4986E7"}),n=e.routes[0].overview_path;for(var a in n)r.getPath().push(n[a]);r.setMap(i.map),i.polylines.push(r)}})},i.recalculateRoute=function(e){if(e.arrayIndex>0){i.polylines[e.arrayIndex-1].setMap(null);var o={origin:i.markers[e.arrayIndex-1].position,destination:e.position,travelMode:google.maps.DirectionsTravelMode.DRIVING};i.directionsService.route(o,function(o,t){if(t==google.maps.DirectionsStatus.OK){var r=new google.maps.Polyline({map:i.map,strokeColor:"#4986E7"}),n=o.routes[0].overview_path;for(var a in n)r.getPath().push(n[a]);r.setMap(i.map),i.polylines[e.arrayIndex-1]=r}})}},i.clearOverlays=function(){for(var e=0;e<i.markers.length;e++)i.markers[e].setMap(null);i.markers.length=0},i.fetchCoordinates=function(){if(i.markers.length>0)for(var e=0;e<i.markers.length;e++)i.route.coordinates.push({latitude:i.markers[e].getPosition().lat(),longitude:i.markers[e].getPosition().lng()})},i.initialize()}angular.module("commuttrApp.components.routeCreate").controller("RouteCreateController",["AuthService","ToastService","StorageService","RouteCreateService",e])}(),function(){"use strict";function e(e,o,t){return{create:function(r,i,n,a,s,l,u){var c="route_name="+(r||"")+"&destination="+(i||"")+"&origin="+(n||"")+"&vice_versa="+(a||0);if(s.length>0)for(var d in s)s[d].location.length>0&&(c+="&via_route[]="+s[d].location);if(l.length>0)for(var p in l)c+="&mode_of_transportation[]="+l[p].id;if(u.length>0)for(var g=0;g<u.length;g++)c+="&coordinates["+g+"][latitude]="+u[g].latitude+"&coordinates["+g+"][longitude]="+u[g].longitude;return e.post(t.API_URL+"routes/create?user_id="+o.user().id,c)},transportation:function(){return e.get(t.API_URL+"transportation/vehicle_lists")},vehicles:function(o){return e.get(t.API_URL+"vehicles/lists?user_id="+o)}}}angular.module("commuttrApp.components.routeCreate").factory("RouteCreateService",["$http","AuthService","CONFIG",e])}();