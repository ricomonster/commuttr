!function(){"use strict";function e(e,t,o,r,i){var a=this;a.route=[],a.route.coordinates=[],a.route.vehicles=[],a.route.via_route=[{location:""}],a.vehicle=[],a.formErrors=[],a.directionsService="",a.directionsRenderer="",a.map="",a.markers=[],a.polylines=[],a.isFirst=!0,a.initialize=function(){a.user=t.user(),i.transportation().success(function(e){e.vehicles&&(a.vehicleLists=e.vehicles)}),e.vehicle_id&&a.getVehicleDetails(),a.initializeGoogleMaps()},a.getVehicleDetails=function(){var t=e.vehicle_id;i.vehicleDetails(t).success(function(e){e.vehicle&&(a.vehicle=e.vehicle)})},a.addViaRoute=function(e){e.preventDefault(),a.route.via_route.push({location:""})},a.select=function(e,t){var o=t.indexOf(e);o>-1?t.splice(o,1):t.push(e)},a.exists=function(e,t){return t.indexOf(e)>-1},a.submitRoute=function(){a.fetchCoordinates(),a.formErrors=[];var e=a.route,t=a.vehicle.id||"";i.create(e.route_name,e.destination,e.origin,e.vice_versa,e.via_route,e.vehicles,e.coordinates,t).success(function(e){e.route&&(a.clearForm(),o.show("You have successfully created the route.",5e3))}).error(function(e){o.show("There are errors encountered.",5e3),a.formErrors=e.errors})},a.clearForm=function(){a.route=[],a.route.coordinates=[],a.route.vehicles=[],a.route.via_route=[{location:""}],a.initializeGoogleMaps()},a.initializeGoogleMaps=function(){var e=r.get("coordinates"),t=new google.maps.LatLng(e.latitude,e.longitude);a.directionsService=new google.maps.DirectionsService,a.directionsRenderer=new google.maps.DirectionsRenderer,a.map=new google.maps.Map(document.getElementById("map_canvas"),{zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP,center:t,mapTypeControl:!1,streetViewControl:!1}),a.directionsRenderer.setMap(a.map),google.maps.event.addListener(a.map,"click",function(e){a.addWayPointToRoute(e.latLng)})},a.addWayPointToRoute=function(e){a.isFirst?(a.addFirstWayPoint(e),a.isFirst=!1):a.appendWayPoint(e)},a.addFirstWayPoint=function(e){var t={origin:e,destination:e,travelMode:google.maps.DirectionsTravelMode.DRIVING};a.directionsService.route(t,function(e,t){if(t==google.maps.DirectionsStatus.OK){var o=new google.maps.Marker({position:e.routes[0].legs[0].start_location,map:a.map,draggable:!0});o.arrayIndex=0,a.markers.push(o),google.maps.event.addListener(o,"dragend",function(){a.recalculateRoute(o)})}})},a.appendWayPoint=function(e){var t={origin:a.markers[a.markers.length-1].position,destination:e,travelMode:google.maps.DirectionsTravelMode.DRIVING};a.directionsService.route(t,function(e,t){if(t==google.maps.DirectionsStatus.OK){var o=new google.maps.Marker({position:e.routes[0].legs[0].end_location,map:a.map,draggable:!0});a.markers.push(o),o.arrayIndex=a.markers.length-1,google.maps.event.addListener(o,"dragend",function(){a.recalculateRoute(o)});var r=new google.maps.Polyline({map:a.map,strokeColor:"#4986E7"}),i=e.routes[0].overview_path;for(var n in i)r.getPath().push(i[n]);r.setMap(a.map),a.polylines.push(r)}})},a.recalculateRoute=function(e){if(e.arrayIndex>0){a.polylines[e.arrayIndex-1].setMap(null);var t={origin:a.markers[e.arrayIndex-1].position,destination:e.position,travelMode:google.maps.DirectionsTravelMode.DRIVING};a.directionsService.route(t,function(t,o){if(o==google.maps.DirectionsStatus.OK){var r=new google.maps.Polyline({map:a.map,strokeColor:"#4986E7"}),i=t.routes[0].overview_path;for(var n in i)r.getPath().push(i[n]);r.setMap(a.map),a.polylines[e.arrayIndex-1]=r}})}},a.clearOverlays=function(){for(var e=0;e<a.markers.length;e++)a.markers[e].setMap(null);a.markers.length=0},a.fetchCoordinates=function(){if(a.markers.length>0)for(var e=0;e<a.markers.length;e++)a.route.coordinates.push({latitude:a.markers[e].getPosition().lat(),longitude:a.markers[e].getPosition().lng()})},a.initialize()}angular.module("commuttrApp.components.routeCreate").controller("RouteCreateController",["$stateParams","AuthService","ToastService","StorageService","RouteCreateService",e])}(),function(){"use strict";function e(e,t,o){return{create:function(r,i,a,n,s,l,c,u){var d="?user_id="+t.user().id;u&&(d+="&vehicle_id="+u);var p="route_name="+(r||"")+"&destination="+(i||"")+"&origin="+(a||"")+"&vice_versa="+(n||0);if(s.length>0)for(var g in s)s[g].location.length>0&&(p+="&via_route[]="+s[g].location);if(l.length>0)for(var v in l)p+="&mode_of_transportation[]="+l[v].id;if(c.length>0)for(var m=0;m<c.length;m++)p+="&coordinates["+m+"][latitude]="+c[m].latitude+"&coordinates["+m+"][longitude]="+c[m].longitude;return e.post(o.API_URL+"routes/create"+d,p)},transportation:function(){return e.get(o.API_URL+"transportation/vehicle_lists")},vehicleDetails:function(t){return e.get(o.API_URL+"vehicles/detail?vehicle_id="+t)}}}angular.module("commuttrApp.components.routeCreate").factory("RouteCreateService",["$http","AuthService","CONFIG",e])}();